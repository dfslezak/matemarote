{% extends 'base.html' %}

{% load i18n %}
{% load staticfiles %}


{% block title%}{% trans 'Mate Marote' %}{% endblock %}
{% block head%}{% endblock %}
{% block content %}

<div class="container">

    <div style="max-width: 400px; margin: 0 auto 10px;">
        <p><a href="#game-add-modal" class="btn btn-large btn-block btn-primary" role="button" data-toggle="modal">{% trans 'Create new game' %}</a></p>
    </div>
    {% for g in games %}

        <h1>{{ g.name }}</h1>
        <p class="lead">{{ g.description }}</p>
        <p><a href="#game-rev-add-modal" class="btn btn-success open-gamerevmodal" role="button" data-toggle="modal" data-id="{{ g.name }}">{% trans 'Create new version' %}</a></p>
        <table class="table table-striped">
        <tbody>
        {% for gr in g.gamerevision_set.all %}
            <tr>
                <td>{% trans 'Version' %}: {{ gr.version }} <small>({% trans 'Created on' %} {{ gr.creation_date|date:"SHORT_DATE_FORMAT" }})</td>
                <td><a href="#" class="btn btn-info">{% trans 'Upload version package' %}</a></td>
            </tr>
        {% endfor %}      
        </tbody>
        </table>
    {% endfor %}      
</div>
<div id="game-add-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="gameAddLabel" aria-hidden="true">
    <form id="game-add-form" method="post" action="/games/add_game/">{% csrf_token %}
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="myModalLabel">{% trans 'Add game...' %}</h3>
    </div>
    <div class="modal-body">
            {{ add_game_form.as_p }}
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        <input class="btn btn-primary" type="submit" value="{% trans 'Add Game' %}" id="submit-addgame"/>
    </div>
    </form>
</div>

<div id="game-rev-add-modal" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="gameRevAddLabel" aria-hidden="true">
    <form id="game-rev-add-form" method="post" action="/games/add_game_revision/">{% csrf_token %}
    <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
        <h3 id="myModalLabel">{% trans 'Add game revision...' %}</h3>
    </div>
    <div class="modal-body">
            <input type="hidden" value="" name="gameref"/>
            {{ add_game_revision_form.as_p }}
    </div>
    <div class="modal-footer">
        <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
        <input class="btn btn-primary" type="submit" value="{% trans 'Add Game Revision' %}" />
    </div>
    </form>
</div>

{% endblock %}

{% block endscripts %}
<script>
$(document).on("click", ".open-gamerevmodal", function () {
     var gameref = $(this).data('id');
     $(".game-rev-add-modal #gameref").val( gameref);
     // As pointed out in comments, 
     // it is superfluous to have to manually call the modal.
     // $('#addBookDialog').modal('show');
});
</script>
{% endblock %}